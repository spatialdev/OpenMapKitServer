---
layout: default
controllerjs: users
auth: auth
mixins: header-mixin
---

<div class="page-content">

<transition name="fade">

    <div id="userManagement"  v-if="activeUser == null">
        <div class="mdl-grid" >

          <a href="/omk/pages/forms/" class="backLink">
                < Back to forms page
            </a>

            <div class="section header">
                <h3>User Management</h3>
            </div>
            <div class="section inputs">
                <button class="mdl-button mdl-button--colored mdl-js-button addUserButton" id="menu-lower-left"
                @click="addUser()">
                  <i class="material-icons">person_add</i> ADD USER
                </button>
                  <div class="search">
                  <ui-textbox
                      icon="search"
                      icon-position="right"
                      floating-label
                      label="Search"
                      placeholder="search user"
                      v-model="searchQuery"
                  ></ui-textbox>
                  </div>

                  <div class="editButotn" style="float: right;">
                  <!-- Colored FAB button -->
                  <button class="mdl-button mdl-js-button mdl-button--fab save" @click="toggleEditMode()">
                    <i class="material-icons" v-if='!editMode'>mode_edit</i>
                    <span style="font-size: 12px;" class="saveText" v-else>edit</span>
                  </button>

                </div>

            </div>
            <div class="section table">

                <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="width: 100%" >
                  <thead>
                    <tr v-if="tableHeader">
                      <th v-for='h in tableHeader'>[{formatHeader(h)}]</th>
                      <th v-show="editMode"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="data in filteredData">
                       <template>

                          <td v-for="header in tableHeader">

                            <span v-if="header === 'admin'">
                              <i class="material-icons" v-if="data[header]">done</i>
                            </span>
                            <span v-else-if="header === 'read'">
                              <i class="material-icons" v-if="data[header]">done</i>
                            </span>
                            <span v-else-if="header === 'write'">
                              <i class="material-icons" v-if="data[header]">done</i>
                            </span>
                            <span v-else-if="header === 'username'" @click="getUserDetails(data['id'])" class="userLink">
                              [{data[[header]]}]
                            </span>
                            <span v-else>
                              [{data[[header]]}]
                            </span>

                          </td>
                          <td style="background-color: #f1f1f1; cursor: pointer;" v-show="editMode">
                            <i class="material-icons" @click="deleteUserDialog(data['id'])" style="color:red;"
                            v-if="user.id !== data.id">delete</i>
                          </td>
                       </template >
                    </tr>
                  </tbody>
                </table>

            </div>
        </div>
        <!-- Enketo Dialog -->
      <dialog id="addUser" class="mdl-dialog">

          <div v-show="!userAdded">
              <h6 class="mdl-dialog__title">
                <i class="material-icons">person_add</i> Add user
              </h6>
              <div class="mdl-dialog__content">
                  <!-- <div class="search mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="username" v-model="newUser.username"
                    pattern="[A-Z,a-z,0-9]*">
                    <label class="mdl-textfield__label" for="username">username</label>
                    <span class="mdl-textfield__error">Letters and spaces only</span>
                  </div> -->
                  <ui-textbox
                      floating-label
                      label="Username"
                      type="text"
                      placeholder="Enter your username"
                      :value="ifNullReturnEmptyString(newUser.username)"
                      v-model="newUser.username"
                  ></ui-textbox>
                  <ui-textbox
                      floating-label
                      label="Password"
                      type="text"
                      placeholder="Enter your password"
                      :value="ifNullReturnEmptyString(newUser.password)"
                      v-model="newUser.password"
                  ></ui-textbox>
                  <ui-textbox
                      floating-label
                      label="First Name"
                      type="text"
                      placeholder="Enter your first name"
                      :value="ifNullReturnEmptyString(newUser.first_name)"
                      v-model="newUser.first_name"
                  ></ui-textbox>
                  <ui-textbox
                      floating-label
                      label="Last Name"
                      type="text"
                      placeholder="Enter your last name"
                      :value="ifNullReturnEmptyString(newUser.last_name)"
                      v-model="newUser.last_name"
                  ></ui-textbox>
                  <ui-textbox
                      floating-label
                      label="Email"
                      type="text"
                      placeholder="Enter your email"
                      :value="ifNullReturnEmptyString(newUser.email)"
                      v-model="newUser.email"
                  ></ui-textbox>

                  <div class="perm">Permissions:</div>

                  <div>

                  <ul>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-1">
                            <input type="radio" id="option-1" class="mdl-radio__button" name="options" value="admin" v-model="newUser.role">
                            <span class="mdl-radio__label">System Admin</span>
                          </label>
                        </li>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-3">
                            <input type="radio" id="option-3" class="mdl-radio__button" name="options" value="read"
                            v-model="newUser.role">
                            <span class="mdl-radio__label">Read & edit</span>
                          </label>
                        </li>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-2">
                            <input type="radio" id="option-2" class="mdl-radio__button" name="options" value="write"
                            v-model="newUser.role">
                            <span class="mdl-radio__label">Read only</span>
                          </label>
                        </li>
                    </ul>

                  </div>

              </div>
              <div class="mdl-dialog__actions">
                  <a>
                      <button type="button" class="mdl-button mdl-js-button modalButton" @click="createNewUser()"
                      :disabled="!validateUserFrom">SUBMIT</button>
                  </a>
                  <button type="button" class="mdl-button mdl-js-button modalButton" @click="closeDialog()">CANCEL</button>
              </div>

          </div>
          <div v-show="userAdded">

            <h6 class="mdl-dialog__title">
                <i class="material-icons">person_add</i> Added user
              </h6>
              <div class="mdl-dialog__content">
                <p>The new user has been added.</p>
              </div>
              <div class="mdl-dialog__actions">
                  <button type="button" class="mdl-button mdl-js-button closeDial" @click="closeDialog()">Close</button>
              </div>

          </div>

      </dialog>
    </div>

  </transition>

<transition name="fade">
    <div id="activeUser" v-if="activeUser != null">

      <div class="mdl-grid" >

            <span class="backLink" @click="activeUser = null">
                < Back to user management
            </span>

            <div class="section header">
                <h3>User account</h3>
                <div class="editButotn" style="float: right;">
                  <!-- Colored FAB button -->
                  <button class="mdl-button mdl-js-button mdl-button--fab" v-if='!editMode' @click="toggleEditMode()">
                    <i class="material-icons">mode_edit</i>
                  </button>
                  <button class="mdl-button mdl-js-button mdl-button--fab" style="width: 100%;" v-else @click="updateUserDetails()">
                    Save
                  </button>
                </div>
            </div>
            <div class="section inputs" v-if="activeUser != null">

                  <ui-textbox
                      floating-label
                      label="First Name"
                      type="text"
                      placeholder="Enter your first name"
                      :value="ifNullReturnEmptyString(activeUser.first_name)"
                      v-model="activeUser.first_name"
                      :disabled="!editMode"
                      :class="{'is-active' : isFocused}"
                  ></ui-textbox>

                  <ui-textbox
                      floating-label
                      label="Last Name"
                      placeholder="Enter your last name"
                      :value="ifNullReturnEmptyString(activeUser.last_name)"
                      v-model="activeUser.last_name"
                      :disabled="!editMode"
                      :class="{'is-active' : isFocused}"
                  ></ui-textbox>
                  <ui-textbox
                      floating-label
                      label="Email"
                      placeholder="Enter your email"
                      :value="ifNullReturnEmptyString(activeUser.email)"
                      v-model="activeUser.email"
                      :disabled="!editMode"
                      :class="{'is-active' : isFocused}"
                  ></ui-textbox>

            </div>
            <div class="section">
              <span v-show="activeUser.formPermissions.length > 0">List of survey forms this user is assigned to:</span>
              <button class="mdl-button mdl-button--colored mdl-js-button" id="menu-lower-left"
                @click="addForm()" style="float: right;">
                  <i class="material-icons">add</i> ADD FORM
                </button>
            </div>

            <div class="section table" v-show="activeUser.formPermissions.length > 0">

              <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="width: 100%" >
                  <thead>
                    <tr v-if="tableHeader">
                      <th>Form title</th>
                      <th>Admin</th>
                      <th>Read</th>
                      <th>Write</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(form, index) in activeUser.formPermissions">
                       <template>

                       <td>
                         [{form.form_id}]
                       </td>
                       <td>
                         <div v-show="!editMode">
                           <i class="material-icons" v-if="form.admin">done</i>
                         </div>
                         <div v-show="editMode">
                            <i class="material-icons" v-if="!form.admin" @click="setOthersToFalse(form, 'admin')">crop_3_2</i>
                            <i class="material-icons" v-if="form.admin" @click="setOthersToFalse(form, 'admin')">done</i>
                         </div>

                       </td>
                       <td>
                          <div v-show="!editMode">
                            <i class="material-icons" v-if="form.read">done</i>
                          </div>
                          <div v-show="editMode">
                            <i class="material-icons" v-if="!form.read" @click="setOthersToFalse(form, 'read')">crop_3_2</i>
                            <i class="material-icons" v-if="form.read" @click="setOthersToFalse(form, 'read')">done</i>
                          </div>

                       </td>
                       <td>
                          <div v-show="!editMode">
                            <i class="material-icons" v-if="form.write">done</i>
                          </div>
                          <div v-show="editMode">
                            <i class="material-icons" v-if="!form.write" @click="setOthersToFalse(form, 'write')">crop_3_2</i>
                            <i class="material-icons" v-if="form.write" @click="setOthersToFalse(form, 'write')">done</i>
                          </div>
                       </td>

                          <td ><i class="material-icons" @click="deleteDialog(form.form_id)" style="color:red;" v-show="editMode">delete</i></td>
                       </template >
                    </tr>
                  </tbody>
                </table>


            </div>

      </div>

    </div>
</transition>

<dialog id="addForm-dialog" class="mdl-dialog">

          <div v-show="!formAdded">
              <h6 class="mdl-dialog__title">
                <i class="material-icons">add</i> Add form
              </h6>
              <div class="mdl-dialog__content">

                  <select v-model="selectedForm">
                    <option value="default" selected disabled>select your form</option>
                    <option v-for="(form, index) in formList" :value="form.form_id">[{form.form_id}]</option>
                  </select>

                  <div class="perm">Permissions:</div>

                  <div>
                  <ul>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-1">
                            <input type="radio" id="option-1" class="mdl-radio__button" name="options" value="admin" v-model="selectedFormRole">
                            <span class="mdl-radio__label">System Admin</span>
                          </label>
                        </li>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-3">
                            <input type="radio" id="option-3" class="mdl-radio__button" name="options" value="read"
                            v-model="selectedFormRole">
                            <span class="mdl-radio__label">Read & edit</span>
                          </label>
                        </li>
                        <li>
                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-2">
                            <input type="radio" id="option-2" class="mdl-radio__button" name="options" value="write"
                            v-model="selectedFormRole">
                            <span class="mdl-radio__label">Read only</span>
                          </label>
                        </li>
                    </ul>

                  </div>

              </div>
              <div class="mdl-dialog__actions">
                  <a>
                      <button type="button" class="mdl-button mdl-js-button modalButton" @click="createNewFormAssignment()"
                      :disabled="!selectedForm">SUBMIT</button>
                  </a>
                  <button type="button" class="mdl-button mdl-js-button modalButton" @click="closeDialog()">CANCEL</button>
              </div>

          </div>
          <div v-show="formAdded">

            <h6 class="mdl-dialog__title">
                <i class="material-icons">add</i> Added Form
              </h6>
              <div class="mdl-dialog__content">
                <p>The new form has been added to user.</p>
              </div>
              <div class="mdl-dialog__actions">
                  <button type="button" class="mdl-button mdl-js-button closeDial" @click="closeDialog()">Close</button>
              </div>

          </div>

      </dialog>


      <dialog id="deleteForm-dialog" class="mdl-dialog">

          <div v-if="activeUser != null">
              <h6 class="mdl-dialog__title">
                <i class="material-icons">minus</i> Delete form
              </h6>
              <div class="mdl-dialog__content">
              </div>
              <div class="mdl-dialog__actions">
                  <a>
                      <button type="button" class="mdl-button mdl-js-button" @click="deleteFormAssigment()"
                      >YES</button>
                  </a>
                  <button type="button" class="mdl-button mdl-js-button" @click="closeDeleteDialog()">CANCEL</button>
              </div>

          </div>

      </dialog>

      <dialog id="deleteUser-dialog" class="mdl-dialog">

          <div>
              <h6 class="mdl-dialog__title">
                <i class="material-icons">minus</i> Delete user
              </h6>
              <div class="mdl-dialog__content">

              </div>
              <div class="mdl-dialog__actions">
                  <a>
                      <button type="button" class="mdl-button mdl-js-button" @click="deleteUser()"
                      >YES</button>
                  </a>
                  <button type="button" class="mdl-button mdl-js-button" @click="closeDeleteUserDialog()">CANCEL</button>
              </div>

          </div>

      </dialog>

</div>


<link rel="stylesheet" href="../css/users.scss">
<link rel="stylesheet" href="../css/dialog-polyfill.css">